#!/bin/bash
set -e

if [[ $# -ne 2 ]]; then
  echo "Invalid parameters." >&2
  exit 
fi

#echo "Downloading info..."
#youtube-dl -F $1 | grep -P "^[^\[]"
fmt=140
#read -p "Enter desired format: " fmt

echo "Downloading video..."
youtube-dl --output "%(id)s" -f $fmt $1

echo "Converting video..."
ffmpeg -i "$1" -codec:v copy -codec:a libmp3lame -q:a 2 "$2.mp3"

echo "Cleaning up..."
rm "$1"

echo "Setting tags..."
id3v2 --artist "Quad City DJs" "$2.flac"
id3v2 --album "VS." "$2.flac"
id3v2 --song "$(echo $2 | sed "s/\-/ /g" | sed "s/\..*//g")" "$2.flac"

echo "Complete!"
